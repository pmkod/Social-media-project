// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                String             @id @default(uuid())
  email             String             @unique
  fullName          String?            @map("full_name")
  username          String             @unique @map("username")
  password          String
  postCount         Int                @default(0) @map("post_count")
  followerCount     Int                @default(0) @map("follower_count")
  followCount       Int                @default(0) @map("follow_count")
  active            Boolean            @default(false)
  userVerifications UserVerification[]
  createdAt         DateTime           @default(now()) @map("created_at")
  refreshTokens     RefreshToken[]
  posts             Post[]
  comments          Comment[]
  postLikes         PostLike[]
  commentLikes      CommentLike[]
  followers         Follow[]           @relation("followed")
  follows           Follow[]           @relation("follower")

  @@map("user")
}

model UserVerification {
  id                            String    @id @default(uuid())
  email                         String?
  password                      String?
  goal                          String?
  verifiedAt                    DateTime? @map("verified_at")
  goalAchievedAt                DateTime? @map("goal_achieved_at")
  disabledAt                    DateTime? @map("disabled_at")
  code                          String    @db.VarChar(10)
  token                         String
  numberOfFailedAttempts        Int       @default(0) @map("number_of_failed_attempts") @db.SmallInt
  numberOfCodeTransfersViaEmail Int       @default(0) @map("number_of_code_transfers_via_email") @db.SmallInt
  user                          User?     @relation(fields: [userId], references: [id])
  userId                        String?   @map("user_id")
  ip                            String?
  agent                         String?
  createdAt                     DateTime  @default(now()) @map("created_at")

  @@map("user_verification")
}

model RefreshToken {
  id         String    @id @default(uuid())
  active     Boolean   @default(false)
  user       User      @relation(fields: [userId], references: [id])
  userId     String    @map("user_id")
  disabledAt DateTime? @map("disabled_at")
  ip         String?
  agent      String?
  createdAt  DateTime  @default(now()) @map("created_at")

  @@map("refresh_token")
}

model Post {
  id        String   @id @default(uuid())
  content   String
  createdAt DateTime @default(now()) @map("created_at")
  exists    Boolean  @default(true)
  visible   Boolean  @default(true)

  likeCount    Int @default(0) @map("like_count")
  commentCount Int @default(0) @map("comment_count")

  author   User   @relation(fields: [authorId], references: [id])
  authorId String @map("author_id")

  comments  Comment[]
  postLikes PostLike[]

  @@map("post")
}

model PostLike {
  post    Post   @relation(fields: [postId], references: [id])
  postId  String @map("post_id")
  liker   User   @relation(fields: [likerId], references: [id])
  likerId String @map("liker_id")

  likedAt DateTime @default(now()) @map("liked_at")

  @@id([postId, likerId])
  @@map("post_like")
}

model Comment {
  id                String        @id @default(uuid())
  content           String
  createdAt         DateTime      @default(now()) @map("created_at")
  exists            Boolean       @default(true)
  visible           Boolean       @default(true)
  likeCount         Int           @default(0) @map("like_count")
  childCommentCount Int           @default(0) @map("child_comment_count")
  author            User          @relation(fields: [authorId], references: [id])
  authorId          String        @map("author_id")
  post              Post          @relation(fields: [postId], references: [id])
  postId            String        @map("post_id")
  commentLikes      CommentLike[]
  childComments     Comment[]     @relation("commentChildComments")
  parentComment     Comment?      @relation("commentChildComments", fields: [parentCommentId], references: [id])
  parentCommentId   String?       @map("parent_comment_id")

  @@map("comment")
}

model CommentLike {
  liker     User    @relation(fields: [likerId], references: [id])
  likerId   String  @map("liker_id")
  comment   Comment @relation(fields: [commentId], references: [id])
  commentId String  @map("comment_id")

  likedAt DateTime @default(now()) @map("liked_at")

  @@id([commentId, likerId])
  @@map("comment_like")
}

model Follow {
  follower   User   @relation("follower", fields: [followerId], references: [id])
  followerId String @map("follower_id")

  followed   User   @relation("followed", fields: [followedId], references: [id])
  followedId String @map("followed_id")

  createdAt DateTime @default(now()) @map("created_at")

  @@id([followerId, followedId])
  @@map("follow")
}
